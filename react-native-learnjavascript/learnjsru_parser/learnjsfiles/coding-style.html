
		<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=yes, minimum-scale=1.0">
		<link rel="stylesheet" type="text/css" href="./styles.css">
		<link rel="stylesheet" type="text/css" href="./prism.css">
		<script src="./prism.js"></script>
		</head><body><div class="page__inner"><main class="main main_width-limit"><article itemscope="" itemtype="http://schema.org/TechArticle"><meta content="Советы по стилю кода" itemprop="name"><div itemprop="author" itemscope="" itemtype="http://schema.org/Person"><meta content="iliakan@gmail.com" itemprop="email"><meta content="Ilya Kantor" itemprop="name"/></meta></div><div itemprop="articleBody"><p>Код должен быть максимально читаемым и понятным. Для этого нужен <em>хороший стиль</em> написания кода. В этой главе мы рассмотрим компоненты такого стиля.</p>
<cut>
<h2><a class="main__anchor" href="#синтаксис" name="синтаксис">Синтаксис</a></h2><p>Шпаргалка с правилами синтаксиса (детально их варианты разобраны далее):</p>
<figure><div class="image" style="width:723px">
<div class="image__ratio" style="padding-top:77.731673582296%"></div>
<img alt="" class="image__image" height="562" src="article/coding-style/code-style.png" width="723">
</img></div></figure><!--
```js
function pow(x, n) {
  var result = 1;

  for (var i = 0; i < n; i++) {
    result *= x;
  }

  return result;
}

var x = prompt("x?", "");
var n = prompt("n?", "");

if (n < 0) {
  alert('Степень ' + n +
    'не поддерживается, введите целую степень, большую 0');
} else {
  alert( pow(x, n) );
}
```

-->
<p>Не всё здесь однозначно, так что разберём эти правила подробнее.</p>
<h3><a class="main__anchor" href="#фигурные-скобки" name="фигурные-скобки">Фигурные скобки</a></h3><p>Пишутся на той же строке, так называемый «египетский» стиль. Перед скобкой – пробел.</p>
<!--
```js no-beautify
if (n < 0) {alert('Степень ' + n + ' не поддерживается');}

if (n < 0) alert('Степень ' + n + ' не поддерживается');

if (n < 0) {
  alert('Степень ' + n + ' не поддерживается');
}
```

-->
<figure><div class="image" style="width:489px">
<div class="image__ratio" style="padding-top:76.07361963190185%"></div>
<img alt="" class="image__image" height="372" src="article/coding-style/figure-bracket-style.png" width="489">
</img></div></figure><p>Если у вас уже есть опыт в разработке, и вы привыкли делать скобку на отдельной строке – это тоже вариант. В конце концов, решать вам. Но в большинстве JavaScript-фреймворков стиль именно такой.</p>
<p>Если условие и код достаточно короткие, например <code>if (cond) return null</code>, то запись в одну строку вполне читаема… Но, как правило, отдельная строка всё равно воспринимается лучше.</p>
<h3><a class="main__anchor" href="#длина-строки" name="длина-строки">Длина строки</a></h3><p>Максимальную длину строки согласовывают в команде. Как правило, это либо <code>80</code>, либо <code>120</code> символов, в зависимости от того, какие мониторы у разработчиков.</p>
<p>Более длинные строки необходимо разбивать для улучшения читаемости.</p>
<h3><a class="main__anchor" href="#отступы" name="отступы">Отступы</a></h3><p>Отступы нужны двух типов:</p>
<ul>
<li>
<p><strong>Горизонтальный отступ, при вложенности – два(или четыре) пробела.</strong></p>
<p>Как правило, используются именно пробелы, т.к. они позволяют сделать более гибкие «конфигурации отступов», чем символ «Tab».</p>
<p>Например, выровнять аргументы относительно открывающей скобки:</p>
<div class="code-example" data-trusted="1">
<div class="codebox code-example__codebox">
<div class="codebox__code" data-code="1">
<pre class="line-numbers language-javascript"><code class="language-javascript">show("Строки" +
     " выровнены" +
     " строго" +
     " одна под другой");</code></pre>
</div>
</div>
</div></li>
<li>
<p><strong>Вертикальный отступ, для лучшей разбивки кода – перевод строки.</strong></p>
<p>Используется, чтобы разделить логические блоки внутри одной функции. В примере разделены инициализация переменных, главный цикл и возвращение результата:</p>
<div class="code-example" data-trusted="1">
<div class="codebox code-example__codebox">
<div class="codebox__code" data-code="1">
<pre class="line-numbers language-javascript"><code class="language-javascript">function pow(x, n) {
  var result = 1;
  //              &lt;--
  for (var i = 0; i &lt; n; i++) {
    result *= x;
  }
  //              &lt;--
  return result;
}</code></pre>
</div>
</div>
</div><p>Вставляйте дополнительный перевод строки туда, где это сделает код более читаемым. Не должно быть более 9 строк кода подряд без вертикального отступа.</p>
</li>
</ul>
<h3><a class="main__anchor" href="#точка-с-запятой" name="точка-с-запятой">Точка с запятой</a></h3><p>Точки с запятой нужно ставить, даже если их, казалось бы, можно пропустить.</p>
<p>Есть языки, в которых точка с запятой не обязательна, и её там никто не ставит. В JavaScript перевод строки её заменяет, но лишь частично, поэтому лучше её ставить, как обсуждалось <a href="/structure#semicolon">ранее</a>.</p>
<h2><a class="main__anchor" href="#именование" name="именование">Именование</a></h2><p>Общее правило:</p>
<ul>
<li>Имя переменной – существительное.</li>
<li>Имя функции – глагол или начинается с глагола. Бывает, что имена для краткости делают существительными, но глаголы понятнее.</li>
</ul>
<p>Для имён используется английский язык (не транслит) и верблюжья нотация.</p>
<p>Более подробно – читайте про <a href="/function-basics#function-naming">имена функций</a> и <a href="/variables#variable-naming">имена переменных</a>.</p>
<h2><a class="main__anchor" href="#уровни-вложенности" name="уровни-вложенности">Уровни вложенности</a></h2><p>Уровней вложенности должно быть немного.</p>
<p>Например, <a href="/while-for#continue">проверки в циклах можно делать через «continue»</a>, чтобы не было дополнительного уровня <code>if(..) { ... }</code>:</p>
<p>Вместо:</p>
<div class="code-example" data-trusted="1">
<div class="codebox code-example__codebox">
<div class="codebox__code" data-code="1">
<pre class="line-numbers language-javascript"><code class="language-javascript">for (var i = 0; i &lt; 10; i++) {
  if (i подходит) {
    ... // &lt;- уровень вложенности 2
  }
}</code></pre>
</div>
</div>
</div><p>Используйте:</p>
<div class="code-example" data-highlight-inline="1:8-10,1:21-29" data-trusted="1">
<div class="codebox code-example__codebox">
<div class="codebox__code" data-code="1">
<pre class="line-numbers language-javascript"><code class="language-javascript">for (var i = 0; i &lt; 10; i++) {
  if (i не подходит) continue;
  ...  // &lt;- уровень вложенности 1
}</code></pre>
</div>
</div>
</div><p>Аналогичная ситуация – с <code>if/else</code> и <code>return</code>. Следующие две конструкции идентичны.</p>
<p>Первая:</p>
<div class="code-example" data-highlight-block="3-5" data-trusted="1">
<div class="codebox code-example__codebox">
<div class="codebox__code" data-code="1">
<pre class="line-numbers language-javascript"><code class="language-javascript">function isEven(n) { // проверка чётности
  if (n % 2 == 0) {
    return true;
  } else {
    return false;
  }
}</code></pre>
</div>
</div>
</div><p>Вторая:</p>
<div class="code-example" data-highlight-block="5-5" data-trusted="1">
<div class="codebox code-example__codebox">
<div class="codebox__code" data-code="1">
<pre class="line-numbers language-javascript"><code class="language-javascript">function isEven(n) { // проверка чётности
  if (n % 2 == 0) {
    return true;
  }

  return false;
}</code></pre>
</div>
</div>
</div><p>Если в блоке <code>if</code> идёт <code>return</code>, то <code>else</code> за ним не нужен.</p>
<p><strong>Лучше быстро обработать простые случаи, вернуть результат, а дальше разбираться со сложным, без дополнительного уровня вложенности.</strong></p>
<p>В случае с функцией <code>isEven</code> можно было бы поступить и проще:</p>
<div class="code-example" data-trusted="1">
<div class="codebox code-example__codebox">
<div class="codebox__code" data-code="1">
<pre class="line-numbers language-javascript"><code class="language-javascript">function isEven(n) { // проверка чётности
  return !(n % 2);
}</code></pre>
</div>
</div>
</div><p>…Однако, если код <code>!(n % 2)</code> для вас менее очевиден чем предыдущий вариант, то стоит использовать предыдущий.</p>
<p>Главное для нас – не краткость кода, а его простота и читаемость. Совсем не всегда более короткий код проще для понимания, чем более развёрнутый.</p>
<h2><a class="main__anchor" href="#функции-комментарии" name="функции-комментарии">Функции = Комментарии</a></h2><p>Функции должны быть небольшими. Если функция большая – желательно разбить её на несколько.</p>
<p>Этому правилу бывает сложно следовать, но оно стоит того. При чем же здесь комментарии?</p>
<p>Вызов отдельной небольшой функции не только легче отлаживать и тестировать – сам факт его наличия является <em>отличным комментарием</em>.</p>
<p>Сравните, например, две функции <code>showPrimes(n)</code> для вывода простых чисел до <code>n</code>.</p>
<p>Первый вариант использует метку:</p>
<div class="code-example" data-trusted="1">
<div class="codebox code-example__codebox">
<div class="codebox__code" data-code="1">
<pre class="line-numbers language-javascript"><code class="language-javascript">function showPrimes(n) {
  nextPrime: for (var i = 2; i &lt; n; i++) {

    for (var j = 2; j &lt; i; j++) {
      if (i % j == 0) continue nextPrime;
    }

    alert( i ); // простое
  }
}</code></pre>
</div>
</div>
</div><p>Второй вариант – дополнительную функцию <code>isPrime(n)</code> для проверки на простоту:</p>
<div class="code-example" data-highlight-inline="3:4-30" data-trusted="1">
<div class="codebox code-example__codebox">
<div class="codebox__code" data-code="1">
<pre class="line-numbers language-javascript"><code class="language-javascript">function showPrimes(n) {

  for (var i = 2; i &lt; n; i++) {
    if (!isPrime(i)) continue;

    alert(i);  // простое
  }
}

function isPrime(n) {
  for (var i = 2; i &lt; n; i++) {
    if ( n % i == 0) return false;
  }
  return true;
}</code></pre>
</div>
</div>
</div><p>Второй вариант проще и понятнее, не правда ли? Вместо участка кода мы видим описание действия, которое там совершается (проверка <code>isPrime</code>).</p>
<h2><a class="main__anchor" href="#функции-под-кодом" name="функции-под-кодом">Функции – под кодом</a></h2><p>Есть два способа расположить функции, необходимые для выполнения кода.</p>
<ol>
<li>
<p>Функции над кодом, который их использует:</p>
<div class="code-example" data-highlight-inline="0:3-19,13:3-28" data-trusted="1">
<div class="codebox code-example__codebox">
<div class="codebox__code" data-code="1">
<pre class="line-numbers language-javascript"><code class="language-javascript">// объявить функции
function createElement() {
  ...
}

function setHandler(elem) {
  ...
}

function walkAround() {
  ...
}

// код, использующий функции
var elem = createElement();
setHandler(elem);
walkAround();</code></pre>
</div>
</div>
</div></li>
<li>
<p>Сначала код, а функции внизу:</p>
<div class="code-example" data-highlight-inline="0:3-28,5:7-14" data-trusted="1">
<div class="codebox code-example__codebox">
<div class="codebox__code" data-code="1">
<pre class="line-numbers language-javascript"><code class="language-javascript">// код, использующий функции
var elem = createElement();
setHandler(elem);
walkAround();

// --- функции ---

function createElement() {
  ...
}

function setHandler(elem) {
  ...
}

function walkAround() {
  ...
}</code></pre>
</div>
</div>
</div></li>
</ol>
<p>…На самом деле существует еще третий «стиль», при котором функции хаотично разбросаны по коду, но это ведь не наш метод, да?</p>
<p><strong>Как правило, лучше располагать функции под кодом, который их использует.</strong></p>
<p>То есть, предпочтителен 2-й способ.</p>
<p>Дело в том, что при чтении такого кода мы хотим знать в первую очередь, <em>что он делает</em>, а уже затем <em>какие функции ему помогают.</em> Если первым идёт код, то это как раз дает необходимую информацию. Что же касается функций, то вполне возможно нам и не понадобится их читать, особенно если они названы адекватно и то, что они делают, понятно из названия.</p>
<h2><a class="main__anchor" href="#плохие-комментарии" name="плохие-комментарии">Плохие комментарии</a></h2><p>В коде нужны комментарии.</p>
<p>Сразу начну с того, каких комментариев быть почти не должно.</p>
<p><strong>Должен быть минимум комментариев, которые отвечают на вопрос «что происходит в коде?»</strong></p>
<p>Что интересно, в коде начинающих разработчиков обычно комментариев либо нет, либо они как раз такого типа: «что делается в этих строках».</p>
<p>Серьёзно, хороший код и так понятен.</p>
<p>Об этом замечательно выразился Р.Мартин в книге <a href="http://www.ozon.ru/context/detail/id/21916535/">«Чистый код»</a>: «Если вам кажется, что нужно добавить комментарий для улучшения понимания, это значит, что ваш код недостаточно прост, и, может, стоит переписать его».</p>
<p>Если у вас образовалась длинная «простыня», то, возможно, стоит разбить её на отдельные функции, и тогда из их названий будет понятно, что делает тот или иной фрагмент.</p>
<p>Да, конечно, бывают сложные алгоритмы, хитрые решения для оптимизации, поэтому нельзя такие комментарии просто запретить. Но перед тем, как писать подобное – подумайте: «Нельзя ли сделать код понятным и без них?»</p>
<h2><a class="main__anchor" href="#хорошие-комментарии" name="хорошие-комментарии">Хорошие комментарии</a></h2><p>А какие комментарии полезны и приветствуются?</p>
<ul>
<li>
<p><strong>Архитектурный комментарий – «как оно, вообще, устроено».</strong></p>
<p>Какие компоненты есть, какие технологии использованы, поток взаимодействия. О чём и зачем этот скрипт. Взгляд с высоты птичьего полёта. Эти комментарии особенно нужны, если вы не один, а проект большой.</p>
<p>Для описания архитектуры, кстати, создан специальный язык <a href="http://ru.wikipedia.org/wiki/Unified_Modeling_Language">UML</a>, красивые диаграммы, но можно и без этого. Главное – чтобы понятно.</p>
</li>
<li>
<p><strong>Справочный комментарий перед функцией – о том, что именно она делает, какие параметры принимает и что возвращает.</strong></p>
<p>Для таких комментариев существует синтаксис <a href="http://en.wikipedia.org/wiki/JSDoc">JSDoc</a>.</p>
<div class="code-example" data-trusted="1">
<div class="codebox code-example__codebox">
<div class="codebox__code" data-code="1">
<pre class="line-numbers language-javascript"><code class="language-javascript">/**
 * Возвращает x в степени n, только для натуральных n
 *
 * @param {number} x Число для возведения в степень.
 * @param {number} n Показатель степени, натуральное число.
 * @return {number} x в степени n.
 */
function pow(x, n) {
  ...
}</code></pre>
</div>
</div>
</div><p>Такие комментарии позволяют сразу понять, что принимает и что делает функция, не вникая в код.</p>
<p>Кстати, они автоматически обрабатываются многими редакторами, например <a href="http://aptana.com">Aptana</a> и редакторами от <a href="http://www.jetbrains.com/">JetBrains</a>, которые  учитывают их при автодополнении, а также выводят их в автоподсказках при наборе кода.</p>
<p>Кроме того, есть инструменты, например <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3</a>, которые умеют  генерировать по таким комментариям документацию в формате HTML. Более подробную информацию об этом можно также найти на сайте <a href="http://usejsdoc.org/">http://usejsdoc.org/</a>.</p>
</li>
</ul>
<p><strong>…Но куда более важными могут быть комментарии, которые объясняют не <em>что</em>, а <em>почему</em> в коде происходит именно это!</strong></p>
<p>Как правило, из кода можно понять, что он делает. Бывает, конечно, всякое, но, в конце концов, вы этот код <em>видите</em>. Однако гораздо важнее может быть то, чего вы <em>не видите</em>!</p>
<p><em>Почему</em> это сделано именно так? На это сам код ответа не даёт.</p>
<p>Например:</p>
<dl>
<dt>Есть несколько способов решения задачи. Почему выбран именно этот?</dt>
<dd>
<p>Например, пробовали решить задачу по-другому, но не получилось – напишите об этом. Почему вы выбрали именно этот способ решения? Особенно это важно в тех случаях, когда используется не первый приходящий в голову способ, а какой-то другой.</p>
<p>Без этого возможна, например, такая ситуация:</p>
</dd>
</dl>
<ul>
<li>
<p>Вы открываете код, который был написан какое-то время назад, и видите, что он «неоптимален».</p>
</li>
<li>
<p>Думаете: «Какой я был дурак», и переписываете под «более очевидный и правильный» вариант.</p>
</li>
<li>
<p>…Порыв, конечно, хороший, да только этот вариант вы уже обдумали раньше. И отказались, а почему – забыли. В процессе переписывания вспомнили, конечно (к счастью), но результат – потеря времени на повторное обдумывание.</p>
<p>Комментарии, которые объясняют выбор решения, очень важны. Они помогают понять происходящее и предпринять правильные шаги при развитии кода.</p>
</li>
</ul>
<dl>
<dt>Какие неочевидные возможности обеспечивает этот код? Где ещё они используются?</dt>
<dd>В хорошем коде должно быть минимум неочевидного. Но там, где это есть – пожалуйста, комментируйте.</dd>
</dl>
<div class="important important_smart">
<div class="important__header"><span class="important__type">Комментарии – это важно</span></div>
<div class="important__content"><p>Один из показателей хорошего разработчика – качество комментариев, которые позволяют эффективно поддерживать код, возвращаться к нему после любой паузы и легко вносить изменения.</p>
</div></div>
<h2><a class="main__anchor" href="#руководства-по-стилю" name="руководства-по-стилю">Руководства по стилю</a></h2><p>Когда написанием проекта занимается целая команда, то должен существовать один стандарт кода, описывающий где и когда ставить пробелы, запятые, переносы строк и т.п.</p>
<p>Сейчас, когда есть столько готовых проектов, нет смысла придумывать целиком своё руководство по стилю. Можно взять уже готовое, и которому, по желанию, всегда можно что-то добавить.</p>
<p>Большинство есть на английском, сообщите мне, если найдёте хороший перевод:</p>
<ul>
<li><a href="http://google-styleguide.googlecode.com/svn/trunk/javascriptguide.xml">Google JavaScript Style Guide</a></li>
<li><a href="http://docs.jquery.com/JQuery_Core_Style_Guidelines">JQuery Core Style Guidelines</a></li>
<li><a href="https://github.com/airbnb/javascript">Airbnb JavaScript Style Guide</a></li>
<li><a href="https://github.com/rwldrn/idiomatic.js">Idiomatic.JS</a> (есть <a href="https://github.com/rwldrn/idiomatic.js/tree/master/translations/ru_RU">перевод</a>)</li>
<li><a href="http://dojotoolkit.org/community/styleGuide">Dojo Style Guide</a></li>
</ul>
<p>Для того, чтобы начать разработку, вполне хватит элементов стилей, обозначенных в этой главе. В дальнейшем, посмотрев эти руководства, вы можете выработать и свой стиль, но лучше не делать его особенно «уникальным и неповторимым», себе дороже потом будет с людьми сотрудничать.</p>
<h2><a class="main__anchor" href="#автоматизированные-средства-проверки" name="автоматизированные-средства-проверки">Автоматизированные средства проверки</a></h2><p>Существуют средства, проверяющие стиль кода.</p>
<p>Самые известные – это:</p>
<ul>
<li><a href="http://www.jslint.com/">JSLint</a> – проверяет код на соответствие <a href="http://www.jslint.com/lint.html">стилю JSLint</a>, в онлайн-интерфейсе вверху можно ввести код, а внизу различные настройки проверки, чтобы сделать её более мягкой.</li>
<li><a href="http://www.jshint.com/">JSHint</a> – вариант JSLint с большим количеством настроек.</li>
<li><a href="https://developers.google.com/closure/utilities/">Closure Linter</a> – проверка на соответствие <a href="http://google-styleguide.googlecode.com/svn/trunk/javascriptguide.xml">Google JavaScript Style Guide</a>.</li>
</ul>
<p>В частности, JSLint и JSHint интегрированы с большинством редакторов, они гибко настраиваются под нужный стиль и совершенно незаметно улучшают разработку, подсказывая, где и что поправить.</p>
<p>Побочный эффект – они видят некоторые ошибки, например необъявленные переменные. У меня это обычно результат опечатки, которые таким образом сразу отлавливаются. Очень рекомендую поставить что-то из этого. Я использую <a href="http://www.jshint.com/">JSHint</a>.</p>
<h2><a class="main__anchor" href="#итого" name="итого">Итого</a></h2><p>Описанные принципы оформления кода уместны в большинстве проектов. Есть и другие полезные соглашения.</p>
<p>Следуя (или не следуя) им, необходимо помнить, что любые советы по стилю хороши лишь тогда, когда делают код читаемее, понятнее, проще в поддержке.</p>
</cut></div></meta></article></main></div></body></html>